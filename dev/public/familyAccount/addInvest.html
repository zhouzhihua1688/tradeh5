<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>追加购买</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="../base/css/base.css">
    <script type="text/javascript" src="../base/js/baseHead.js"></script>
    <script type="text/javascript" src="../base/js/needLogin.js"></script>
    <script>
        // 相对字体大小设置
        var oHtml = document.documentElement;
        getFont();
        window.onresize = function () {
            getFont();
        }

        function getFont() {
            var screenWidth = oHtml.clientWidth;
            if (screenWidth <= 320) {
                oHtml.style.fontSize = '17.06px';
            } else if (screenWidth >= 750) {
                oHtml.style.fontSize = '40px';
            } else {
                oHtml.style.fontSize = screenWidth / (750 / 40) + 'px';
            }
        }
	</script>
   <style>
	body,html{background: #f6f6f6;}
	body {left: 0%; right: 0%;font:14px 'PingFang SC','Microsoft YaHei', Tahoma, Arial, sans-serif;}
	button { outline: none;  }
	  /* 图片自适应 */
	img {width: 100%; height: auto; width: auto\9; /* ie8 */ -ms-interpolation-mode: bicubic;/*为了照顾ie图片缩放失真*/ border: none; vertical-align: top; outline: none; display: block; }
	.main{width:100%;height:100%;}
	.head{width: 18.75rem;height:10.5rem;background: url('img/plan.png') no-repeat;background-size: 100% 100%;}
	.head .portrait{width:100%;height:1.75rem;padding-top: 0.7rem}
	.head .portrait img{width:1.575rem;height:1.575rem;margin-left:0.75rem;vertical-align: middle;display: inline-block;}
	.head .portrait span{font-size:0.65rem;color:#fff;display: inline-block;margin-left:0.5rem;}
	.head .save{font-size:0.75rem;color:#fff;margin-top:0.45rem;text-align: center}
	.head .money{font-size: 1.5rem;color:#fff;text-align: center;margin-top:0.45rem;}
	.head .listText{width:100%;display:flex;justify-content:space-between;align-items: center;margin-top:0.75rem}
	.head .listText div{width:33.3%;font-size: 0.65rem;color:#ffd0d2;text-align: center;}
	.head .listText div:nth-of-type(2){text-indent:1.75rem}
	.head .listText div:nth-of-type(2) img{width:0.75rem;height: 0.75rem;display: inline-block;vertical-align: middle;margin-left:0.35rem;}
	.head .listText div:nth-of-type(3){text-align:right;margin-right:0.75rem}
	.head .numberList{width:100%;display:flex;justify-content:space-between;align-items: center;margin-top:0.25rem;}
	.head .numberList div{width:33.3%;font-size:0.8rem;color:#fff;text-align: center;}
	.head .numberList div:nth-of-type(1){text-align:left;text-indent:1.25rem}
	.head .numberList div:nth-of-type(2){text-indent:1.5rem}
	.head .numberList div:nth-of-type(3){text-align:right;margin-right:0.75rem}
	.touzi{display: none;width:100%;height:1.7rem;background: #f6f6f6;position: relative;top:-0.5rem;border-radius:10px 10px 0 0;font-size: 0.7rem;color:#666;line-height:2.2rem}
	.touzi img{width:0.925rem;height:0.925rem;display: inline-block;vertical-align: middle;margin-left:0.75rem;margin-right:0.5rem;margin-top:-0.1rem;}
	.noDetails{width:100%;}
	.noDetails img{width:5.475rem;height:6.625rem;margin:0 auto;margin-top:4.375rem;}
	.noDetails .text{font-size: 0.65rem;color:#666;text-align: center;margin-top:0.5rem;}
	.nameList{width:17.25rem;margin:0 auto;background:#fff;margin-bottom: 0.5rem;border-radius:8px;}

	.nameList .account{width:100%;height:2.25rem;display:flex;justify-content:space-between;align-items: center;border-bottom:1px solid #eee;}
	.nameList .account div:nth-of-type(1){width:80%}
	.nameList .account div:nth-of-type(1){text-indent:0.85rem;font-size: 0.7rem;color: #666}
	.nameList .account div:nth-of-type(2){text-align: right;font-size: 0.6rem;color: #fb5c5f;margin-right:0.75rem;}
	.nameList .account div:nth-of-type(2) span{width:5.75rem;height: 1rem;display: inline-block;background: #ffefef;border-radius:1.25rem;line-height: 1rem;text-align: center}

	.nameList .fundName{width:100%;height:2.25rem;display:flex;justify-content:space-between;align-items: center;}
	.nameList .fundName div:nth-of-type(1){width:80%;margin-left:0.85rem;font-size:0.8rem;color: #000;display: inline-block;}
	.nameList .fundName div:nth-of-type(1) span{width:1.65rem;height:0.875rem;display: inline-block;font-size: 0.6rem;color: #fb5c5f; background: #ffefef;text-align: center;line-height: 0.875rem;margin-left: 0.5rem;}
	.nameList .fundName div:nth-of-type(2) img{width:0.4rem;height:0.75rem;margin-right:0.75rem;}

	.nameList .nameText{width:100%;height:2.25rem;display:flex;justify-content:space-between;align-items: center;margin-top:-0.5rem;}
	.nameList .nameText div{width:33.3%;font-size:0.75rem;color:#666;text-align: center;}
	.nameList .nameText div:nth-of-type(2){text-indent:1rem}
	.nameList .nameText div:nth-of-type(3){text-align:right;margin-right:0.75rem;}

	.nameList .numberText{width:100%;height:2.25rem;display:flex;justify-content:space-between;align-items: center;
		margin-top:-0.5rem;border-bottom:1px solid #eee;margin-top:-0.85rem;}
	.nameList .numberText div{width:33.3%;font-size:0.5rem;color:#000;text-align: center;}
	.nameList .numberText div:nth-of-type(2){text-indent:1rem;}
	.nameList .numberText div:nth-of-type(3){text-align:right;color:#f4333c;margin-right:0.75rem;}
	footer {position: fixed; width: 100%; height:2.5rem; left: 0; bottom: 0; background-color: #fff; font-size:0.85rem; border-right: 1px solid #fff;}
	footer ul li{float:left; width:100%; background: #ff6169; } 
	footer ul li a {display: block;}
	footer ul li a {width: 100%; height:2.5rem; text-align: center; line-height:2.5rem; color: #fff; font-size:0.85rem;border-left: 1px solid #fff; }
	footer ul li:nth-of-type(1){background: #ff6169;}
	footer ul li:nth-of-type(1) a{color: #fff;}
	.buy_btn{
		background: #FB5C5F;
    color: #fff;
    padding: .1rem .85rem;
    border-radius: 1.2rem;
	}
</style>
</head>
<body>
	<div class="main" style="padding-bottom:3rem">

		<!-- 没有数据的时候 -->
		<div class="noDetails" style="display: none">
			<div><img src="img/noDetail.png" alt=""></div>
			<div class="text">暂无可选投资</div>
		</div>
		<!-- 有投资数据的时候 -->

		 
	 
		<footer>
			 <ul>
				 <li>
					 <a href="javascript:;" class="addOther" style="color:#fff;background:#0757b2;width:100%">买入其他产品</a>
				 </li>
			 </ul>
		 </footer>
	 </div>

	
<script type="text/javascript" src="../base/js/lib/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../base/js/utils.js"></script>

<script>
    var teamId = '';
    //是否开启亲情宝 获取teamId
    function getAccount(){
        utils.get('/sfs/v1/accounts/is-open?version=6.6',null,function(result){
            if(result.returnCode == 0){
                if(result.body.isOpen){
                    teamId = result.body.teamId
					showPlanDetail();
                }
            }
        });
    }
	var accountId = utils.getUrlParam("accountId");
	var arAcct = utils.getUrlParam("arAcct");

	$(function(){
		
		getAccount();

	});

	//买入其他产品
	$(".addOther").click(function(){
		window.location.href = "allFund.html?arAcct="+arAcct;
	})
	//计划详情
	function showPlanDetail(){
		utils.get('/sfs/v1/accounts/assets/plans/detail?accountId='+accountId,null,function(result){
			var body = result.body;
			if(result.returnCode == 0){

				$(".assetTotalAmount").html(formatMoney(body.assetTotalAmount));
				$(".currencyTypeUnit").html(body.currencyTypeUnit);
				$(".holdYield").html(formatMoney(body.holdYield));
				$(".lastYield").html(formatMoney(body.lastYieldAmount));
				$(".totalYield").html(formatMoney(body.totalYield));
				$(".yieldDate").html((body.yieldDate ? body.yieldDate.substring(4,6)+'.'+body.yieldDate.substring(6,8):'--'));
				var investedMemberVo = body.investedMemberVo;
				if(investedMemberVo){
					$("#avatarImage").attr("src",investedMemberVo.avatarImage).show();
					$(".dis").html(investedMemberVo.memberNameDisplay+'('+investedMemberVo.memberRoleName+')');
				}
				var custAssets = body.custAssets;
				if(custAssets.length > 0){
					var htm = '';
					custAssets.forEach(function(item,index){
					htm+='		<div class="nameList">'+
						'<div class="account">'+
							'<div>'+item.memberRoleName+'买过的</div>'+
							'<div></div>'+
						'</div>';
						var assetDetailList = item.assetDetailList;
						assetDetailList.forEach(function(item2,index2){
							htm+='<div class="fundName" >'+
								'<div>'+item2.fundName+ '</div>'+
								'<div ></div>'+
							'</div>'+
							'<div class="nameText">'+
								'<div class="near_'+item2.fundId+'"></div>'+
								'<div class="day_'+item2.fundId+'"></div>'+
								'<div data-fundId="'+item2.fundId+'" data-productType="'+item2.productType+'" onclick="gotoNext(this)"><span class="buy_btn">购买</span></div>'+
							'</div>'+
							'<div class="numberText">'+
								'<div>近一年收益率</div>'+
								'<div class="cur_'+item2.fundId+'"></div>'+
								'<div></div>'+
							'</div>';
							//调用接口
							if(item2.fundId.indexOf('A') > -1 || item2.fundId.indexOf('Z') > -1 ||item2.fundId.indexOf('C') > -1 ){//组合
								utils.get('/mobile-bff/v1/fund-group/detailInfo?groupId='+item2.fundId,null,function(res2){
									if(res2.returnCode == 0){
										var bd2 = res2.body;
										$(".cur_"+item2.fundId).html('日涨跌幅('+(bd2.dayYieldDt ? bd2.dayYieldDt.substring(5,7)+'.'+bd2.dayYieldDt.substring(8,10):'--')+')');

										$(".near_"+item2.fundId).html(bd2.nearYearProfit+"%").css({"color":showColor(bd2.nearYearProfit)});
										$(".day_"+item2.fundId).html(Number(bd2.dayYield).toFixed(2)+"%").css({"color":showColor(bd2.dayYield)});
									}
								});
							}else{//基金
								utils.post('/mobile-bff/v1/fund/detailInfo',JSON.stringify({"fundId": item2.fundId}),function(res1){
									if(res1.returnCode == 0){
										var bd1 = res1.body;
										$(".cur_"+item2.fundId).html('日涨跌幅('+(bd1.navDt ? bd1.navDt.substring(4,6)+'.'+bd1.navDt.substring(6,8):'--')+')');

										$(".near_"+item2.fundId).html(bd1.yearProfitStr+"%").css({"color":showColor(bd1.yearProfitStr)});
										$(".day_"+item2.fundId).html(Number(bd1.yield.toFixed(2))+"%").css({"color":showColor(bd1.yield)});
									}
								});
							}
						});
					htm+='</div>';
					});

					$(htm).insertBefore('footer');
					$(".touzi").show()
				}else{
					$(".noDetails").show();
				}

			}
		});
	}
	//去购买
	function gotoNext(obj){
		utils.setSession("_selectArAcct",arAcct);
		if($(obj).attr('data-productType') == "1"){//基金
			window.location.href = '/mobileEC/wap/fund/payment.html?fundId='+$(obj).attr('data-fundId');
		}else if($(obj).attr('data-productType') == "3"){//组合
			window.location.href = '/mobileEC/wap/fundgroup/payment.html?groupId='+$(obj).attr('data-fundId');
		}
	}
</script>
</body>
</html>
